<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Финансовый учёт</title>
<style>
  body {
    margin: 0;
    font-family: Inter, sans-serif;
    background: #0b0f14;
    color: #e6eef6;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
  }
  .app {
    width: 100%;
    max-width: 700px;
    background: #11161d;
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 0 25px rgba(0,0,0,0.4);
  }
  h1 {
    margin: 0 0 10px 0;
    font-size: 20px;
  }
  .balance {
    background: #1a222d;
    border-radius: 12px;
    padding: 14px;
    text-align: center;
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 15px;
  }
  .accounts {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    margin-bottom: 15px;
  }
  .acc {
    flex: 1;
    background: #151c25;
    padding: 10px;
    border-radius: 10px;
    text-align: center;
  }
  .acc-name {
    font-size: 14px;
    color: #aaa;
  }
  .acc-amount {
    font-weight: 700;
    margin-top: 4px;
  }
  .buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
  }
  button {
    flex: 1;
    padding: 10px;
    border: 0;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
  }
  .add { background: #5b6bff; color: #fff; }
  .exp { background: #ff5b5b; color: #fff; }
  .history {
    background: #141b23;
    border-radius: 10px;
    padding: 10px;
    max-height: 260px;
    overflow-y: auto;
  }
  .tx {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
  }
  .tx:last-child { border-bottom: none; }
  .income { color: #2dd4bf; }
  .expense { color: #ff6b6b; }
  .small { font-size: 13px; color: #aaa; }
  .modal {
    position: fixed;
    inset: 0;
    display: none;
    justify-content: center;
    align-items: center;
    background: rgba(0,0,0,0.7);
  }
  .modal.show { display: flex; }
  .modal-card {
    background: #111820;
    padding: 20px;
    border-radius: 12px;
    width: 300px;
  }
  input, select {
    width: 100%;
    margin-bottom: 10px;
    padding: 8px;
    border-radius: 8px;
    border: 1px solid #222;
    background: #1a222d;
    color: #fff;
  }
</style>
</head>
<body>
<div class="app">
  <h1>Финансы</h1>
  <div class="balance" id="total">₪0.00</div>
  <div class="accounts" id="accs"></div>
  <div class="buttons">
    <button class="add" id="incomeBtn">+ Доход</button>
    <button class="exp" id="expenseBtn">– Расход</button>
  </div>
  <div class="history" id="history"></div>
</div>

<!-- модальное окно -->
<div class="modal" id="modal">
  <div class="modal-card">
    <h3 id="modalTitle"></h3>
    <div id="modalBody"></div>
    <button id="saveBtn">Сохранить</button>
  </div>
</div>

<script>
const key = "finance_data_v2";
const def = {
  accs: {
    wallet: { name:"Кошелёк", balance:0 },
    card: { name:"Карта", balance:0 },
    save: { name:"Накопление", balance:0 }
  },
  txs: []
};
let data = JSON.parse(localStorage.getItem(key) || JSON.stringify(def));

function save(){ localStorage.setItem(key, JSON.stringify(data)); render(); }
function fmt(v){ return "₪" + Number(v).toFixed(2); }

function render(){
  // total
  const total = Object.values(data.accs).reduce((s,a)=>s+a.balance,0);
  document.getElementById("total").textContent = fmt(total);
  // accs
  const accs = document.getElementById("accs");
  accs.innerHTML = "";
  for(const [k,a] of Object.entries(data.accs)){
    const d = document.createElement("div");
    d.className="acc";
    d.innerHTML = `<div class="acc-name">${a.name}</div>
                   <div class="acc-amount">${fmt(a.balance)}</div>`;
    accs.appendChild(d);
  }
  // history
  const hist = document.getElementById("history");
  hist.innerHTML = "";
  if(data.txs.length===0){
    hist.innerHTML = `<div class="small">Нет операций</div>`;
  } else {
    data.txs.slice().reverse().forEach(t=>{
      const div = document.createElement("div");
      div.className="tx";
      div.innerHTML = `<div>${t.note}</div>
                       <div class="${t.type==='income'?'income':'expense'}">${t.type==='income'?'+':'-'}${fmt(t.amount)}</div>`;
      hist.appendChild(div);
    });
  }
}

function addIncome(sum){
  const w=sum*0.5, c=sum*0.3, s=sum*0.2;
  data.accs.wallet.balance+=w;
  data.accs.card.balance+=c;
  data.accs.save.balance+=s;
  data.txs.push({type:"income",amount:sum,note:"Доход"});
  save();
}
function addExpense(acc,sum,note){
  if(data.accs[acc].balance<sum) return alert("Недостаточно средств");
  data.accs[acc].balance-=sum;
  data.txs.push({type:"expense",amount:sum,note:note||"Расход"});
  save();
}

// Модалка
const modal=document.getElementById("modal"), body=document.getElementById("modalBody");
function openIncome(){
  document.getElementById("modalTitle").textContent="Добавить доход";
  body.innerHTML=`<input id='sum' type='number' placeholder='Сумма'>`;
  document.getElementById("saveBtn").onclick=()=>{
    const v=Number(document.getElementById("sum").value);
    if(v>0){ addIncome(v); close(); }
  };
  modal.classList.add("show");
}
function openExpense(){
  document.getElementById("modalTitle").textContent="Добавить расход";
  body.innerHTML=`<select id='acc'>
      <option value='wallet'>Кошелёк</option>
      <option value='card'>Карта</option>
      <option value='save'>Накопление</option>
    </select>
    <input id='sum' type='number' placeholder='Сумма'>
    <input id='note' placeholder='Примечание'>`;
  document.getElementById("saveBtn").onclick=()=>{
    const a=document.getElementById("acc").value;
    const v=Number(document.getElementById("sum").value);
    const n=document.getElementById("note").value;
    if(v>0){ addExpense(a,v,n); close(); }
  };
  modal.classList.add("show");
}
function close(){ modal.classList.remove("show"); }

document.getElementById("incomeBtn").onclick=openIncome;
document.getElementById("expenseBtn").onclick=openExpense;
modal.onclick=e=>{ if(e.target===modal) close(); }

render();
</script>
</body>
</html>
